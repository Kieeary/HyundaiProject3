<html lang="ko" class="back" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="wck/includes/head :: head_tag(title='주문/배송/반품/취소 | 더한섬닷컴')"></th:block>

<body class="back">

  <!-- Loading -->
  <div style="display: none">
    <div id="loadingBarDiv" style="display: none"></div>
  </div>
  <!-- //Loading -->

  <div id="mapleMainPopwrap" style="
        position: fixed;
        top: 50%;
        left: 50%;
        width: 81.333333%;
        z-index: 805;
        transform: translate(-50%, -50%);
        display: none;
      "></div>

  <div class="layerArea" id="mapleLayer" style="display: none">
    <div class="layerBg"></div>
  </div>

  <!-- ################## hsome_allContents_wrapper­ ################## -->
  <div class="hsome_allContents_wrapper">
    <div class="hsome_allContents">

      <!-- ########## header start ########## -->
        <header  
        th:replace = "wck/includes/header_select2 :: header_select_tag('주문배송조회',2)"
        class="hsome_header header_noline header_mypage"></header>
      <!-- ########## header end ########## -->

      <input type="hidden" id="tempCheckQuick" />
      <!-- ########## contents start ########## -->
      <div id="contents" class="hsome_contents mp_order_list_wrap">
        <form id="orderSearchForm" action="/ko/mypage/order/myorderlist">
          <input type="hidden" id="searchDeliveryType" name="searchDeliveryType" value="" />
          <div class="gray_tab_grid">
            <div>
              <ul class="border_tab_1 grid_4">
                <li class="on">
                  <a href="javascript:;" class="monthBtn" id="setDateBtn1" data-month=1>1개월<!-- 1주일 --></a>
                </li>
                <li>
                  <a href="javascript:;" class="monthBtn" id="setDateBtn2" data-month=2>2개월<!-- 1개월 --></a>
                </li>
                <li>
                  <a href="javascript:;" class="monthBtn" id="setDateBtn3" data-month=6>6개월<!-- 3개월 --></a>
                </li>
                <li>
                  <a href="javascript:;" class="monthBtn" id="setDateBtn4" data-month=12>1년<!-- 3개월 --></a>
                </li>
              </ul>

            </div>
          </div>
        </form>

        <div class="mp_order_dlvr_list_wrap" id="listBody">
          <!-- ########## Goods list start ########## -->

          <!-- ########## Goods list end ########## -->

        </div>
        <div class="pagingArea" style="display:flex; justify-content:center;">
          <div id="prev" style="margin-right: 10px; font-weight:bold;">이전</div>
          <div id="next" style="font-weight:bold;">다음</div>
        </div>




        <!-- ########## 주문 배송 조회 안내 시작 ########## -->
        <div class="df_box mp_order_dvlr_guide_wrap last_box">
          <h3 class="df_box_tit">
            주문 배송 조회 안내<!-- 주문 배송 조회 안내 -->
          </h3>
          <ul class="ul_dot">
            <li>
              한섬마일리지는 배송 완료 후 10일 후 지급됩니다.<!-- 한섬마일리지는 배송 완료 후 10일 후 지급됩니다. -->
            </li>
            <li>
              상품 준비 중 이후부터 정보 변경이 불가합니다.<!-- 상품 준비 중 이후부터 정보 변경이 불가합니다. -->
            </li>
            <li>
              주문 시 사용한 기프트카드, 한섬마일리지 모두 동일 수단으로
              환불됩니다.<!-- 주문 시 사용한 기프트카드, 한섬마일리지 모두 동일 수단으로 환불됩니다. -->
            </li>
            <li>
              한섬마일리지는 정상 매장 기준 5% 적립됩니다. (아울렛, 세일상품,
              수입상품의 경우 다를 수 있습니다.)<!-- 한섬마일리지는 정상 매장 기준 5% 적립됩니다. (아울렛, 세일상품, 수입상품의 경우 다를 수 있습니다.) -->
            </li>
            <li>
              가상계좌 결제 시, 4시간 내 입금하지 않으면 자동으로 주문이
              취소됩니다.<!-- 가상계좌 결제 시, 24시간 내 입금하지 않으면 자동으로 주문이 취소됩니다. -->
            </li>
          </ul>
        </div>
        <!-- ########## 주문 배송 조회 안내 끝 ########## -->

      </div>
      <!-- ########## contents end ########## -->


      <div id="DeliveryLayer" style="overflow: auto"></div>


      <!-- ########## footer add ########## -->
      <footer th:replace="wck/includes/footer :: fragment-footer"></footer>

    </div>
  </div>

  <!-- ################## top button­ ################## -->
  <a href="noLink();" class="hsome_topBtn upper" id="handsomeTopBtn">mobile.bottom.top</a>

  <!-- ################## hsome_quickMenu | 퀵메뉴 ################## -->
<th:block th:replace="wck/includes/quick_menu"></th:block>
  <!-- ################## //hsome_quickMenu | 퀵메뉴 ################## -->


  <div class="fixed_dim_layer" onclick="familySiteSelectClosed();"></div>
  <!-- ################## hsome_quickMenu_contents | 퀵메뉴 컨텐츠 영역 ################## -->
  <div class="hsome_quickMenu_contents"></div>
  <!-- //################## hsome_quickMenu_contents | 퀵메뉴 컨텐츠 영역 ################## -->


  <div class="divpop_wrap_dev pop_mbr pop_alert_confirm" id="popAlertConfirmDiv"></div>

  <!-- layerpopupContent s -->
  <!-- hsome_layer_menu_contents | 레이어팝업메뉴 컨텐츠 영역 s -->
  <!-- depth1 s -->
  <div class="hsome_layerpop_contents lp_depth1"></div>
  <!-- depth1 e -->
  <!-- depth2 s -->
  <div class="hsome_layerpop_contents lp_depth2"></div>
  <!-- depth2 e -->
  <!-- depth3 s -->
  <div class="hsome_layerpop_contents lp_depth3"></div>
  <!-- depth3 e -->
  <!-- depth4 s -->
  <div class="hsome_layerpop_contents lp_depth4"></div>
  <!-- depth4 e -->
  <!-- depth5 s -->
  <div class="hsome_layerpop_contents lp_depth5"></div>
  <!-- depth5 e -->
  <!-- depth6 s -->
  <div class="hsome_layerpop_contents lp_depth6"></div>
  <!-- depth6 e -->
  <!-- depth7 s -->
  <div class="hsome_layerpop_contents lp_depth7"></div>
  <!-- depth7 e -->
  <!-- depth8 s -->
  <div class="hsome_layerpop_contents lp_depth8"></div>
  <!-- depth8 e -->


  <!-- loading_layerpop s -->
  <!-- layerpop_wrap | 처리중 s -->
  <div class="layerpop_wrap loading_layer_wrap">
    <!-- layerpop_middle s -->
    <div class="lyrpp_mid">
      <div class="loading_box"></div>
    </div>
    <!-- layerpop_middle e -->
  </div>
  <!-- layerpop_wrap | 처리중 e -->
  <!-- loading_layerpop e -->
  <!-- hsome_layer_menu_contents | 레이어팝업메뉴 컨텐츠 영역 e -->
  <!-- layerpopupContent e -->

  <script type="text/javascript">

    $(document).ready(function () {
      let curPage = 1;
      let curMonth = 1;

      getOrderList(curMonth, curPage);

      $('.monthBtn').click(function (e) {
        e.preventDefault();
        let month = $(this).data('month');
        console.log("moht click = " + month);
        curMonth = month;
        curPage = 1;
        getOrderList(curMonth, curPage);
      })

      $('#prev').click(function () {
        console.log('prev clicked');
        if (curPage == 1) return;
        curPage = curPage - 1;
        getOrderList(curMonth, curPage);
      })

      $('#next').click(function () {
        console.log('next clicked');
        curPage = curPage + 1;
        getOrderList(curMonth, curPage);
      })




      function getOrderList(month, pageNum) {
        $.ajax({
          type: 'GET',
          url: '/api/order?month=' + month + '&pageSize=5&currentPage=' + pageNum,
          success: function (data) {

            let tmp = '';
            console.log(data);
            let orders = data['orders'];
            let count = data['count'];

            if (curPage == 1) {
              $('#prev').css('display', 'none');
            } else {
              $('#prev').css('display', 'block');
            }

            if (curPage * 5 > count) {
              $('#next').css('display', 'none');
            } else {
              $('#next').css('display', 'block');
            }


            $(orders).each(function (idx, d) {
              tmp += printOrder(d);
            });

            $('#listBody').html('');
            $('#listBody').append(tmp);

            $('html, body').animate({ scrollTop: 0 }, 400);

          }
        });
      }

      function printOrder(data) {
        let item_html = '';
        $(data.orderProducts).each(function (i, product) {
		console.log(product);
          let item_template = `
  	  	  		<li>
  	                <div class="mpord_goods_item gl_item">
  	                  <div class="gl_tit">
  	                    <a href="#" onclick="">
  	                      <img src="${product.pimg}" class="gl_thumbimg" alt="컬러 블록 양말">
  	                    </a>
  	                  </div>
  	                  <ul class="gl_con">
  	                    <li class="gl_con_brand">
  	                      <a href="#" onclick="">${product.bname}</a>
  	                    </li>
  	                    <li class="gl_con_name">
  	                      <a href="#" onclick="">${product.pname}</a>
  	                    </li>
  	                    <li class="gl_con_option">${product.colorName} / ${product.psize} / ${product.quantity}개</li>
  	                    <li class="gl_con_price">￦${product.quantity * product.pcPrice}</li>
  	                    <li class="gl_con_status">
  	                      <span class="ord_status">${data.ostatus}</span> (${data.odate})
  	                    </li>
  	                  </ul>
  	                  <div class="more_action_wrap">
  	                    <a href="javascript:;" class="btn_more_action"><span>변경</span></a>
  	                    <div class="more_action_ul_wrap">
  	                      <a href="javascript:;" class="btn_more_action_ul_close"><span>닫기</span></a>
  	                      <ul class="more_action_ul">
  	                        <li>
  	                          <a href="#" class="layerpopupOpen"  onclick="cancelOrder('${data.oid}');">주문취소</a>
  	                        </li>
  	                      </ul>
  	                    </div>
  	                  </div>
  	                </div>
  	              </li>
  	  	  		
  	  	  		`
          item_html += item_template;
        })

        let order_template = `
  	            <div class="df_box">
  	            <div class="mpord_tit mpord_dlvr">
  	              <div class="mpord_tit_num">택배배송 ${data.oid}</div>
  	              <div class="mpord_tit_sub">${data.odate}</div>
  	              <a href="/wck/mypage/order/${data.oid}" class="arrow_btn list_detail_btn"
  	                onclick="">
  	                상세보기
  	              </a>
  	            </div>
  	            <ul class="mpord_goods_ul goods_list_wrap">
  	            ${item_html}
  	            </ul>
  	          </div>
  	  		`
        return order_template;
      }

    })

    let token = $("meta[name='_csrf']").attr("content");
    let header = $("meta[name='_csrf_header']").attr("content");

    function cancelOrder(oid) {

      $.ajax({
        url: '/wck/mypage/cancelRequest/' + oid,
        beforeSend: function (xhr) {
          xhr.setRequestHeader(header, token);
        },
        method: 'post',
        success : function(result){
          if(result == "SUCCESS"){
        	  console.log('cancel order complete');
            location.href = '/wck/mypage/order';
          }
        },
        error : function(){
        }
      })
    }


  </script>
<script type="text/javascript" th:src="@{/js/quick_menu.js}" defer></script>
</body>
<!-- This script is for AceCounter START -->

</html>