<html lang="ko" class="" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="wck/includes/head :: head_tag(title='더한섬닷컴')"></th:block>

    <style>
      .swiper-wrapper {
        height: auto;
      }
    </style>
  <body>
    <div class="hsome_allContents_wrapper"></div>

    <a href="noLink();" class="hsome_topBtn upper" id="handsomeTopBtn"
      >mobile.bottom.top</a
    ><!-- 20180530 추가 -->

    <!-- ################## hsome_quickMenu_contents | 퀵메뉴 컨텐츠 영역 ################## -->
    <div class="hsome_quickMenu_contents active absolute">
      <!-- Contents -->
      <div class="hand_footer_gnb_wrap mypage">
        <div class="header">
          <h2 class="sel">
            <select
              id="headerMypageSelect" >
              <option value="" style="display: none"></option>
              <option value="/wck/mypage">
                마이페이지<!-- 마이페이지 -->
              </option>
              <option value="/wck/mypage/order">
                주문/배송조회<!-- 주문/배송조회 -->
              </option>
              <option value="/wck/mypage/wish">
                마이하트<!-- 위시리스트 -->
              </option>
              <option value="/wck/mypage/change/checkpw">
                개인정보변경<!-- 개인정보변경 -->
              </option>
              <!-- 
              <option value="/ko/mypage/voucher">쿠폰<</option>
              <option value="/ko/mypage/myreview">상품평</option>
               -->
            </select>
            
           <script>
          	$('#headerMypageSelect').change(function(e){
          		console.log($(this).val());
          		location.href=$(this).val();
          	})
          </script>
          
            <div class="selected_text">
              <span> 마이페이지</span>
            </div>
          </h2>
          <ul class="red_border_tab">
            <li class="on">
              <a href="#" class="order" tab="order">주문</a>
            </li>
            <li class="">
              <a href="#" class="benefit" tab="benefit">혜택</a>
            </li>
            <li class="">
              <a href="#" class="infomation" tab="info">정보</a>
            </li>
            <li class="">
              <a href="#" class="activity" tab="activity">활동</a>
            </li>
          </ul>
        </div>

        <div class="container">
          <div
            class="swiper-container mypage_card_container mpgCardCon1903 swiper-container-horizontal swiper-container-android swiper-container-wp8-horizontal">
            <div
              class="swiper-wrapper"
              style="
                transform: translate3d(0px, 0px, 0px);
                transition-duration: 0ms;
              ">
              <!-- 주문 -->
              <div
                class="swiper-slide card-type order swiper-slide-active"
                data-index="0"
                style="width: 330px; margin-right: 30px">
                <div class="stage order_stage">
                  <div class="card_type_inner1903">
                    <div class="s-tit">
                      <b>주문조회</b>
                      <a href="/wck/mypage/order" class="more"
                        >주문배송조회</a>
                    </div>
                  </div>
                </div>
              </div>
              <!-- 혜택// -->
              <div
                class="swiper-slide card-type benefit start swiper-slide-next"
                data-index="0"
                style="width: 330px; margin-right: 30px">
                <div class="card_type_inner1903">
                  <div class="stage coupon_stage" id="myCouponList">
                    <div class="s-tit">
                      <b>쿠폰</b>
                      <a href="/ko/mypage/voucher" class="more">전체조회</a>
                    </div>
                    <div id="mypageCouponList">
                    </div>
                  </div>
                </div>
              </div>

              <!-- //혜택 -->

              <!-- 정보// -->

              <div
                class="swiper-slide card-type infomation"
                id="myPagePopupDelivery"
                data-index="1"
                style="width: 330px; margin-right: 30px">
                <div class="card_type_inner1903">

                  <div class="stage delivery_stage">
                    <div class="s-tit">
                      <b>정보 관리</b>
                    </div>

                    <div class="s-btn">
                      <a href="/wck/mypage/change/checkpw"
                        >개인정보 변경/탈퇴</a>
                    </div>

                    <div class="s-txt2">
                      현대백화점 그룹 계열사의 다양한<br />
                      혜택을 하나의 ID로!
                    </div>
                  </div>
                </div>
              </div>
              <!-- //정보 -->

              <!-- 활동// -->
              <div
                class="swiper-slide card-type activity start"
                data-index="0"
                style="width: 330px; margin-right: 30px">
                <div class="card_type_inner1903">
                  <div class="stage wish_stage">
                    <div class="s-tit">
                      <b>위시리스트</b>
                    </div>

                    <div id="myWishlists" class="s-thumb">
                      <p><span>위시리스트에 저장된 상품이 없습니다.</span></p>
                      <a href="/wck/mypage/wish" class="more">+0</a>
                    </div>

                    <div class="s-link">
                      <ul>
                        <li><a href="/ko/mypage/myreview">상품평</a></li>
                        <li>
                          <a
                            href="/ko/mypage/mymantomaninquiry?refererUrl=mypage"
                            >1:1 문의</a
                          >
                        </li>
                        <li>
                          <a href="/ko/mypage/event/myevents"
                            >이벤트 참여현황</a
                          >
                        </li>
                        <li><a href="/ko/mypage/myqna">상품 Q&amp;A</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
              <!-- //활동 -->
            </div>
          </div>

          <div class="mypage_card_footer">
            <span class="u_name">
            <a href="javascript:void(0);">
            <th:block th:switch="${#authentication.principal.grade}">
			    <span th:case="1">FRIEND</span>
			    <span th:case="2">MANIA</span>
			    <span th:case="3">STAR</span>
			</th:block>
              <span th:text="${#authentication.principal.name}">name</span> 님
              </a></span>
            <a
              class="u_profile_setting btn_popup_btot"
              href=".hs_mpg_profile_pop"
              >프로필 설정</a
            >
          </div>
          <div class="mypage_card_footer_logout2008">
            <a
              href="javascript:ftLogout();"
              class="u_logout"
              >로그아웃</a
            >
          </div>
        </div>

        <div class="footer">
          <a
            href="javascript:noLink();"
            class="close"
            onclick="goBack();"
            >닫기</a
          >
        </div>
      </div>
    </div>
    <!-- //################## hsome_quickMenu_contents | 퀵메뉴 컨텐츠 영역 ################## -->

    <script>
      $(document).ready(function () {
    	 getMyOrder();
    	 getMyCoupon();
    	 getMyLike();
    	 
    	 function getMyOrder(){
    		 
    		 $.ajax({
    			 method : 'get',
    			 url : '/api/order?month=1&pageSize=5&currentPage=1',
    			 datatype: 'json',
    			 success : function(list){
    				 let target = $('.order_stage .card_type_inner1903');
    				 console.log(list);
    				 if(list['orders'] == null || list['orders'].lenght == 0){
    					 console.log('no order')
    					 target.append(`<p class="mypage_card_nodata">주문 내역이 없습니다.</p>`);
    				 }else{
    					 let t = list['orders'][0];
    		
    					 let item_html = '';
    					 $(t.orderProducts).each(function(idx, d){
    						 console.log("idx : "+ idx);
    						 console.log("d : "+ d);
        					 let item_template = `
         					 	<div class="order_product" style="padding-top:10px">
         		                 <!-- 개 -->
         		                 <a
         		                   href="/ko/p/SH2C1ACK416M_GY_FR">
         		                   <div class="img">
         		                     <img
         		                       src="${d.pimg}"
         		                       alt="${d.pname}" />
         		                   </div>
         		                   <div class="cont">
         		                     <p class="name">
         		                       <span class="brand"> ${d.bname}</span>
         		                       ${d.pname}
         		                     </p>
         		                     <p class="option">${d.colorName} / ${d.psize} / ${d.quantity}개</p>
         		                     <p class="price_wrap">
         		                       <span class="price">₩${d.quantity * d.pcPrice}</span>
         		                     </p>
         		                   </div>
         		                 </a>
         		               </div>
         		               `;
        					 item_html += item_template;
    					 })
    					 
    					 
    			 		 let template = `
    		                 <p class="order_number">
    		                 <a
    		                   href="/wck/mypage/order/${t.oid}">
    		                   <span class="tit">주문번호<!-- 주문번호 --></span>
    		                   <span class="number">${t.oid}</span>
    		                 </a>
    		               </p>
    		               ${item_html}
    		               <ul class="order_list">
   		                 <li>
   		                   <span class="tit">주문일자</span>
   		                   <span class="txt">${t.odate}</span>
   		                 </li>
   		                 <li>
   		                   <span class="tit">주문금액</span>
   		                   <span class="txt">${t.oafterPrice}원</span>
   		                 </li>
   		               </ul>
    		               
    		    		 `
    			 			target.append(template);
    				 }
        		 },
        		 error: function(request,status,error){
        			 console.log("error : "+ error);
        		 }
    			 
    		 })
   
    	 }
    	 function getMyCoupon(){
    		 $.ajax({
    			 method : 'get',
    			 url : '/api/event/mycoupon',
    			 datatype: 'json',
    			 success : function(list){
    				 console.log(list);
    				 printCoupon(list);
        		 },
        		 error: function(request,status,error){
        			 console.log("error : "+ error);
        		 }
    		 })
    	 }
    	 function printCoupon(list){
    		 list.forEach(function(coupon){
    			 /*<![CDATA[*/
    			 let template = `
    				<div class="s-coupon">
                     <div class="s-coupon-inner">
                       <strong>${coupon.ecouponTitle}</strong><b>${coupon.ediscount}% 할인</b>
                       <span>${coupon.cpIssueDate} ~ ${coupon.cpExpireDate}</span>
                       <i>소멸<br>D-180</i>
                     </div>
                   </div>
    			 ` 
    			/*]]>*/
    			$('#mypageCouponList').append(template);
    				 
    		 })
    	 }
    	 function getMyLike(){
    		 $.ajax({
    			 method : 'get',
    			 url : '/api/member/like?currentPage=1&pageSize=3',
    			 datatype:'json',
    			 success : function(list){
    				 console.log(list);
    				 printLike(list);
    			 }
    		 })
    	 }
    	 function printLike(data){
    		 let list = data['list'];
    		 if(list == null || list.length == 0){
    			 return ;
    		 }
    		 $('#myWishlists').html('');
			 $('#myWishlists').html('<ul></ul>');
    		 
    			 
    		 $(list).each(function(idx,like){
    			 if(idx > 3) return;
    			 /*<![CDATA[*/
    			 let template = `
    				<li>
    			      <a href="/ko/p/MM2D1WOT022HDE">
    			        <img
    			          src="${like.colors[0].pcImg1}"
    			          style="width: 86px; height: 130px"
    			          alt="" />
    			      </a>
    			    </li>
    			 `;
    			 /*]]>*/
    			 $('#myWishlists > ul').append(template);
    		 })
    		 console.log(parseInt(data['count']) - 3)
    		 if(parseInt(data['count']) > 3){
    			 /*<![CDATA[*/
    			 let countUl = `<a href="/wck/mypage/wish" class="more">+${parseInt(data['count']) - 3 }</a>`
    			 /*]]>*/
        		 $('#myWishlists').append(countUl);
    		 }
    		 
    	 }
    	  
    	 // tab ui 모방
        let tabs = $('.red_border_tab li');
        $('a.order').click(function (e) {
          e.preventDefault();
          tabs.removeClass('on');
          $(this).parent().addClass('on');
          $('.swiper-wrapper').css('transform', 'translate3d(0px, 0px, 0px)');
        });
        $('a.benefit').click(function (e) {
          e.preventDefault();
          tabs.removeClass('on');
          $(this).parent().addClass('on');
          $('.swiper-wrapper').css(
            'transform',
            'translate3d(-360px, 0px, 0px)'
          );
        });
        $('a.infomation').click(function (e) {
          e.preventDefault();
          tabs.removeClass('on');
          $(this).parent().addClass('on');
          $('.swiper-wrapper').css(
            'transform',
            'translate3d(-720px, 0px, 0px)'
          );
        });
        $('a.activity').click(function (e) {
          e.preventDefault();
          tabs.removeClass('on');
          $(this).parent().addClass('on');
          $('.swiper-wrapper').css(
            'transform',
            'translate3d(-1080px, 0px, 0px)'
          );
        });

        $('.swiper-wrapper').bind('touchmove', function (e) {
          console.log($(this).css('transform'));
          let x = $(this).css('transform').split('(')[1].split(',')[4];
          console.log(x);
          tabs.removeClass('on');
          if (x > 0) {
            $('a.order').parent().addClass('on');
          } else if (x > -360) {
            $('a.benefit').parent().addClass('on');
          } else if (x > -720) {
            $('a.infomation').parent().addClass('on');
          } else {
            $('a.activity').parent().addClass('on');
          }
        });
      });
    </script>
  </body>
  <!-- This script is for AceCounter START -->
</html>
