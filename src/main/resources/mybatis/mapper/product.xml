<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.wck.mapper.ProductMapper">

 	<resultMap type="com.wck.domain.ProductVO" id="productsMap">
 		<id property="PID" column="PID" />
 		<result property="PNAME" column="PNAME" />
  		<result property="BNAME" column="BNAME" />
   		<result property="PCPRICE" column="PNAME" />
		<collection property="PCCOLORINFO" resultMap="pcColorInfo">
  		</collection> 	
 	</resultMap>
 	
 	<resultMap type="com.wck.domian.DetailProductVO" id= "pcColorInfo">
 		<result property="PCID" column="PCID" />
 		<result property="PCCOLORCODE" column="PCCOLORCODE" />
 		<result property="PCIMG1" column="PCIMG1" />
 		<result property="PCCHIPIMG" column="PCCHIPIMG" />
 	</resultMap>

	<select id="getProducts" resultMap = "productsMap">
		SELECT pcom.pid, pcolor.pcid, pcom.pname, pcom.bname, 
		pcolor.pcimg1, pcolor.pcprice,pcolor.pccolorcode, pcolor.pcchipimg
		FROM product_common pcom
		INNER JOIN product_category pcat
		ON pcom.pid = pcat.pid
		INNER JOIN category c
		<if test="gd != null">
			ON c.depth1name = #{gd}
			<if test=" sC!= null">
				AND ON c.depth2name = #{sC}
			</if>
			<if test=" tC!= null">
				AND ON c.depth3name = #{tC}
			</if>
		</if>
		INNER JOIN product_color pcolor
		ON pcolor.pid = pcom.pid
		GROUP BY pcom.pid, pcom.pname, pcom.bname, 
		pcolor.pcimg1, pcolor.pcprice, pcolor.pcid, pcolor.pccolorcode, pcolor.pcchipimg;
	</select>

</mapper>